---
import Layout from '../../layouts/Layout.astro';
import VideoPlayer from '../../components/VideoPlayer.jsx';
import RelatedVideos from '../../components/RelatedVideos.jsx';
import { VIDEOS } from '../../data/mock.js';
import { Share2, ThumbsUp, Calendar, Eye, MessageSquare } from 'lucide-react';

export function getStaticPaths() {
  return VIDEOS.map(video => ({
    params: { id: video.id },
    props: { video },
  }));
}

const { video } = Astro.props;

// Calculate "related" videos (just excluding current for now)
const relatedVideos = VIDEOS.filter(v => v.id !== video.id);
---

<Layout 
  title={`${video.title} - Video Review`}
  description={video.description}
  image={video.thumbnail}
  ogType="video.other"
>
  <div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      {/* Main Content Column */}
      <div class="lg:col-span-2 space-y-6">
        
        {/* Video Player */}
        <VideoPlayer client:visible videoId={video.id} />
        
        {/* Video Title & Meta */}
        <div>
          <h1 class="text-2xl md:text-3xl font-bold mb-4 leading-tight">{video.title}</h1>
          
          <div class="flex flex-wrap items-center justify-between gap-4 border-b border-neutral-800 pb-4 mb-6">
            <div class="flex items-center gap-4 text-sm text-neutral-400">
                <span class="flex items-center gap-1"><Eye size={16} /> {video.views} views</span>
                <span class="flex items-center gap-1"><Calendar size={16} /> {video.published_at}</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button class="flex items-center gap-2 px-4 py-2 bg-neutral-800 hover:bg-neutral-700 rounded-full text-sm font-medium transition-colors">
                    <ThumbsUp size={18} /> Like
                </button>
                <button class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-full text-sm font-medium transition-colors">
                    <Share2 size={18} /> Share
                </button>
            </div>
          </div>

          {/* Description */}
          <div class="bg-neutral-900/50 p-6 rounded-xl border border-neutral-800">
            <h3 class="font-semibold mb-2">Description</h3>
            <p class="text-neutral-300 leading-relaxed whitespace-pre-line">
              {video.description}
            </p>
            <div class="mt-4 flex flex-wrap gap-2">
                {video.tags && video.tags.map(tag => (
                    <span class="text-xs bg-neutral-800 text-neutral-400 px-2 py-1 rounded-full">#{tag}</span>
                ))}
            </div>
          </div>
          
          {/* Transcript Toggle (Placeholder) */}
          <div class="mt-6 border-t border-neutral-800 pt-4">
            <details class="group">
                <summary class="flex items-center justify-between cursor-pointer list-none text-neutral-400 hover:text-white font-medium">
                    <span>Show Transcript</span>
                    <span class="transition group-open:rotate-180">
                        <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                    </span>
                </summary>
                <div class="text-neutral-500 mt-4 text-sm leading-relaxed">
                    <p>Transcript functionality coming soon...</p>
                </div>
            </details>
          </div>
        </div>
        
        {/* Comments Section (Placeholder) */}
        <div class="mt-12">
            <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
                <MessageSquare size={20} /> Comments
            </h3>
            <div class="bg-neutral-900 rounded-xl p-8 text-center border border-neutral-800">
                <p class="text-neutral-400">Comments are disabled for this preview.</p>
            </div>
        </div>

      </div>

      {/* Sidebar Column */}
      <div class="lg:col-span-1">
        <div class="sticky top-24">
            <h3 class="text-lg font-bold mb-4 text-neutral-200">Related Videos</h3>
            <div class="flex flex-col gap-4">
                 {/* Re-using logic inside a map here or a component */}
                 {relatedVideos.slice(0, 5).map(v => (
                     <a href={`/video/${v.id}`} class="flex gap-3 group">
                        <div class="relative w-40 flex-shrink-0 aspect-video rounded-lg overflow-hidden">
                             <img src={v.thumbnail} class="w-full h-full object-cover group-hover:scale-105 transition-transform" />
                             <span class="absolute bottom-1 right-1 bg-black/80 text-[10px] px-1 rounded text-white">10:00</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-sm font-semibold text-neutral-200 line-clamp-2 group-hover:text-blue-400 leading-snug">{v.title}</h4>
                            <p class="text-xs text-neutral-500 mt-1">{v.published_at}</p>
                        </div>
                     </a>
                 ))}
            </div>
            
            <div class="mt-8 bg-gradient-to-br from-blue-900/20 to-purple-900/20 p-6 rounded-xl border border-blue-500/20">
                <h4 class="font-bold text-white mb-2">Join the Newsletter</h4>
                <p class="text-xs text-neutral-400 mb-4">Get the latest tech reviews delivered to your inbox.</p>
                <input type="email" placeholder="Email address" class="w-full bg-neutral-950 border border-neutral-800 rounded px-3 py-2 text-sm mb-2 focus:border-blue-500 outline-none" />
                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-2 rounded transition-colors">Subscribe</button>
            </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
