---
import Layout from '../../layouts/Layout.astro';
import { BLOG_POSTS } from '../../data/mock.js';
import { ArrowLeft, User, Calendar, Tag } from 'lucide-react';

function readTime(content = '') {
  const words = content.split(/\s+/).filter(Boolean).length;
  return `${Math.max(1, Math.round(words / 200))} min read`;
}

export function getStaticPaths() {
  return BLOG_POSTS.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

const siteUrl = "https://tobyonfitnesstech.com";
const articleJsonLd = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.title,
  "description": post.excerpt || post.title,
  "datePublished": post.published_at,
  "dateModified": post.published_at,
  "url": `${siteUrl}/blog/${post.slug}`,
  ...(post.image ? { "image": post.image.startsWith('http') ? post.image : `${siteUrl}${post.image}` } : {}),
  "author": {
    "@type": "Person",
    "@id": `${siteUrl}/#toby`,
    "name": "Toby Glenn Peters",
    "url": siteUrl
  },
  "publisher": {
    "@type": "Organization",
    "name": "Toby on Fitness Tech",
    "url": siteUrl
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `${siteUrl}/blog/${post.slug}`
  }
};
---

<Layout 
  title={`${post.title} - TobyOnFitnessTech`}
  description={post.excerpt?.slice(0, 155) || post.title}
  image={post.image}
  ogType="article"
  jsonLd={articleJsonLd}
>
  <article class="bg-neutral-950 min-h-screen pb-24">
    {/* Header / Hero */}
    <div class="relative bg-neutral-900 border-b border-neutral-800 pb-16 pt-24 md:pt-32">
      <div class="absolute inset-0 bg-gradient-to-b from-blue-900/10 to-transparent pointer-events-none" />
      <div class="container mx-auto px-4 relative z-10 max-w-4xl">
        <a href="/blog" class="inline-flex items-center text-sm font-semibold text-blue-400 hover:text-blue-300 transition-colors mb-8 group">
          <ArrowLeft size={16} class="mr-2 group-hover:-translate-x-1 transition-transform" /> Back to Analysis
        </a>
        
        <div class="flex items-center gap-4 text-xs font-bold tracking-wider text-blue-500 uppercase mb-4">
            <span class="bg-blue-900/30 px-3 py-1 rounded-full border border-blue-500/30">{post.category}</span>
            <span class="text-neutral-500">â€¢</span>
            <span>{readTime(post.content)}</span>
        </div>
        
        <h1 class="text-3xl md:text-5xl font-bold text-white mb-6 leading-tight">
          {post.title}
        </h1>
        
        <div class="flex items-center gap-6 text-sm text-neutral-400 border-t border-neutral-800 pt-6">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-neutral-800 flex items-center justify-center text-neutral-500">
                    <User size={16} />
                </div>
                <span class="font-medium text-white">Toby</span>
            </div>
            <div class="flex items-center gap-2">
                <Calendar size={16} />
                <span>{new Date(post.published_at).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</span>
            </div>
        </div>
      </div>
    </div>

    {/* Content */}
    <div class="container mx-auto px-4 py-12 max-w-3xl">
      <div class="prose prose-invert prose-lg max-w-none prose-headings:font-bold prose-headings:text-white prose-p:text-neutral-300 prose-a:text-blue-400 hover:prose-a:text-blue-300 prose-strong:text-white prose-ul:text-neutral-300 prose-li:marker:text-blue-500">
        {/* Simulating Markdown Content Rendering */}
        {post.content.split('\n').map((line, index) => {
            if (line.trim().startsWith('##')) {
                return <h2 key={index} class="text-2xl font-bold mt-12 mb-6 text-white border-l-4 border-blue-500 pl-4">{line.replace('##', '').trim()}</h2>;
            }
            if (line.trim().startsWith('#')) {
                return <h1 key={index} class="text-3xl font-bold mt-12 mb-6 text-white">{line.replace('#', '').trim()}</h1>;
            }
            if (line.trim().length > 0) {
                return <p key={index} class="mb-6 leading-relaxed text-neutral-300">{line}</p>;
            }
            return null;
        })}
      </div>
      
      {/* Footer / Tags */}
      {post.tags && post.tags.length > 0 && (
        <div class="mt-16 pt-8 border-t border-neutral-800">
          <div class="flex items-center gap-4 flex-wrap">
            <Tag size={16} class="text-neutral-500" />
            <div class="flex flex-wrap gap-2">
              {post.tags.map(tag => (
                <span class="text-sm bg-neutral-900 border border-neutral-800 px-3 py-1 rounded-full text-neutral-400 hover:text-white transition-colors cursor-pointer">#{tag}</span>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  </article>
</Layout>
